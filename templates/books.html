{% extends 'base.html' %}

{% block body %}
<body>
<h1><a href="{{ url_for('books_create') }}">Create a book</a></h1>
<h1>Books</h1>
<table class="table">
    <thead>
    <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Authors</th>
        <th>Average Rating</th>
        <th>ISBN</th>
        <th>Stock</th>
    </tr>
    </thead>
    <tbody>
    {% for book in books %}
    <tr>
        <td>{{ book.id }}</td>
        <td>{{ book.title }}</td>
        <td>{{ book.authors }}</td>
        <td>{{ book.average_rating }}</td>
        <td>{{ book.isbn }}</td>
        <td>{{ book.stock }}</td>
        <td>
            <button onclick="delete_book(event, '{{book.id}}')">Delete book</button>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
<script>
    async function delete_book(event, book_id) {
        event.preventDefault();
        let response = await fetch(`/api/v1/books/${book_id}`, {
            method: "DELETE",
        });
        let response_body = await response.json();
        if (response.status === 200) {
            window.location.href = "{{ url_for('get_books') }}"
        } else if (response.status === 400) {
            alert("This book doesn't exist");
        } else {
            console.log(`Error: ${JSON.stringify(response_body)}`)
        }
    }
</script>
</body>
{% endblock %}
